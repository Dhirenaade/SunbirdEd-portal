<div *ngIf='programDetails?.userDetails' class="ui pointing secondary menu sb-bg-white"
  style="background-color: white;">
  <div class="ui container">
    <a class="item" *ngIf='programDetails?.userDetails?.roles.includes("CONTRIBUTOR") && !showCertificate'
      [class.active]="sessionContext.currentRole === 'CONTRIBUTOR'"
      (click)="sessionContext.currentRole = 'CONTRIBUTOR';handleRoleChange()">Contribute</a>
    <a class="item" *ngIf='programDetails?.userDetails?.roles.includes("REVIEWER") && !showCertificate'
      [class.active]="sessionContext.currentRole === 'REVIEWER'"
      (click)="sessionContext.currentRole = 'REVIEWER';handleRoleChange()">Review</a>
    <a class="item" *ngIf='programDetails?.userDetails?.roles.includes("PUBLISHER") && !showCertificate'
      [class.active]="sessionContext.currentRole === 'PUBLISHER' && !showDashboard"
      (click)="sessionContext.currentRole = 'PUBLISHER';handleRoleChange()">Publish</a>
    <a class="item" *ngIf='programDetails?.userDetails?.roles.includes("PUBLISHER") && !showCertificate'
      [class.active]="(sessionContext.currentRole === 'PUBLISHER' && showDashboard)"
      (click)="sessionContext.currentRole = 'PUBLISHER';handleRoleChange('Dashboard')">Dashboard</a>
    <a class="item" [class.active]="!showCertDashboard && showCertificate" *ngIf='showCertificate'
      (click)="sessionContext.currentRole = 'CERTIFICATE_ISSUER';handleRoleChange()">Issue&nbsp;Certificate</a>
    <a class="item" [class.active]="showCertDashboard && showCertificate" *ngIf='showCertificate'
      (click)="sessionContext.currentRole = 'CERTIFICATE_ISSUER';handleRoleChange('certificatedashboard')">Certificate
      Dashboard</a>
  </div>
</div>


<!-- Untitled Page section and back button to be developed -->

<!-- <div class="">

  <div *ngIf='programDetails?.userDetails' class="practical-appbar">
    <div class="practical-appbar__content ui container d-flex flex-ai-center">
      <a class="practical-appbar__item"
        *ngIf='programDetails?.userDetails?.roles.includes("CONTRIBUTOR") && !showCertificate'
        [class.active]="sessionContext.currentRole === 'CONTRIBUTOR'"
        (click)="sessionContext.currentRole = 'CONTRIBUTOR';handleRoleChange()">Contribute</a>
      <a class="practical-appbar__item"
        *ngIf='programDetails?.userDetails?.roles.includes("REVIEWER") && !showCertificate'
        [class.active]="sessionContext.currentRole === 'REVIEWER'"
        (click)="sessionContext.currentRole = 'REVIEWER';handleRoleChange()">Review</a>
      <a class="practical-appbar__item"
        *ngIf='programDetails?.userDetails?.roles.includes("PUBLISHER") && !showCertificate'
        [class.active]="sessionContext.currentRole === 'PUBLISHER' && !showDashboard"
        (click)="sessionContext.currentRole = 'PUBLISHER';handleRoleChange()">Publish</a>
      <a class="practical-appbar__item"
        *ngIf='programDetails?.userDetails?.roles.includes("PUBLISHER") && !showCertificate'
        [class.active]="(sessionContext.currentRole === 'PUBLISHER' && showDashboard)"
        (click)="sessionContext.currentRole = 'PUBLISHER';handleRoleChange('Dashboard')">Dashboard</a>
      <a class="practical-appbar__item" [class.active]="!showCertDashboard && showCertificate" *ngIf='showCertificate'
        (click)="sessionContext.currentRole = 'CERTIFICATE_ISSUER';handleRoleChange()">Issue&nbsp;Certificate</a>
      <a class="practical-appbar__item" [class.active]="showCertDashboard && showCertificate" *ngIf='showCertificate'
        (click)="sessionContext.currentRole = 'CERTIFICATE_ISSUER';handleRoleChange('certificatedashboard')">Certificate
        Dashboard</a>

      <button class="sb-btn sb-btn-normal sb-btn-link sb-left-icon-btn" type="button">
        <i class="arrow left icon"></i>Back</button>
    </div>
  </div>
</div> -->
<!--
<div class="d-flex sb-bg-color-gray-0 practical-header">
  <div class="d-flex flex-ai-center flex-jc-space-between practical-header__content ui container">
    <div class="font-weight-bold fs-1" *ngIf="!showTextArea">
      Untiled Practice Set <span class="fs-0-785 pl-8"><a class="cursor-pointer" (click)="showTextArea=!showTextArea">Edit</a></span>
      <div class="fs-0-785 pt-8">License: CC BY 4.0</div>
    </div>

    <div class="sb-field-group textbook-edit" *ngIf="showTextArea">
      <div class="sb-field relative">
        <textarea rows="4" name="moretext" class="sb-form-control" placeholder="Type here..."></textarea>
        <span class="characters-left">200 Characters left</span>
      </div>
    </div>

    <div class='practical-sb-buttons'>
      <button class="sb-btn sb-btn-outline-primary sb-btn-normal ripple mr-8">Change
        File</button>
      <button class="sb-btn sb-btn-primary sb-btn-normal ripple mr-8" (click)="showTextArea=!showTextArea">Save</button>
      <button class="sb-btn sb-btn-primary sb-btn-normal ripple mr-8">Preview</button>
      <button class="sb-btn sb-btn-secondary sb-btn-normal ripple" (click)="showTextArea=!showTextArea">Submit</button>
    </div>
  </div>
</div> -->


<div *ngIf="showCertificate">
  <div *ngIf='!showCertDashboard && (programDetails?.userDetails?.roles.includes("CERTIFICATE_ISSUER"))'
    class="ui segment no-bg m-0 w-300" style="text-align: center; margin-top:2px !important;">
    <div class="ui mt-30 container w-300 sb-box-container" [appTelemetryImpression]="telemetryImpression">
      <!-- <h4>SELECT TYPE</h4> -->
      <div class="mt-30">
        <sui-select class="selection" [placeholder]="'Select Certificate Type'" [isSearchable]=false
          [(ngModel)]="selectedOption">
          <sui-select-option *ngFor="let option of typeOptions" [value]="option.value">
          </sui-select-option>
        </sui-select>
      </div>
      <div class="row" *ngIf="selectedOption">
        <div> Certificate Preview</div>
        <div class="ui container">
          <table class="sb-certificate-table-ct" *ngIf="selectedOption === 'Best School Certificate'">
            <tr>
              <td class="sb-certificate-table">
                <img src="assets/images/gujarat-state-outline.svg" class="state-outline-img" />
                <img src="assets/images/certificate-frame.svg" class="certificate-frame" />
                <div class="sb-certificate-container">
                  <table width="100%" border="0" class="certificate-table-area">
                    <tr class="sb-certificate-header">
                      <td colspan="3">
                        <div class="state-symbol">
                          <img src="assets/images/gujarat-state-logo.png" class="sb-certificatePage-logo"
                            alt="Government of Gujarat">
                        </div>
                        <p class="state-name">Government of Gujarat</p>
                        <h1>Best School Certificate</h1>
                        <p class="certificate-details">This is to certify that Ms <strong>School Name</strong>
                          is certified as <strong>"Best School"</strong> on
                          <strong>25 Jan 2019</strong> </p>
                      </td>
                    </tr>
                    <tr class="sb-certificate-footer">
                      <td class="country-symbol">
                        <img src="assets/images/DIKSHA.png" class="sb-certificatePage-logo" />
                        <!-- <p>આ દસ્તાવેજ ડિજિટલ સહી થયેલ છે</p> -->
                      </td>
                      <td class="state-sign">
                        <img src="$signatory0Image" class="sb-certificatePage-logo" />
                        <div class="sign-line"></div>
                        <p class="italic">Director of GCERT</p>
                      </td>
                      <td class="certificate-qr-code">
                        <img src="assets/images/sb-qr-code.svg" width="60" class="sb-certificate-qrcode" />
                        <p>Scan to verify certificate</p>
                      </td>
                    </tr>
                  </table>

                </div>
                <div class="sb-certificate-bg-"></div>
              </td>
            </tr>
          </table>
          <table class="sb-certificate-table-ct" *ngIf="selectedOption === 'Best Student Certificate'">
            <tr>
              <td class="sb-certificate-table">
                <img src="assets/images/gujarat-state-outline.svg" class="state-outline-img" />
                <img src="assets/images/certificate-frame.svg" class="certificate-frame" />
                <div class="sb-certificate-container">
                  <table width="100%" border="0" class="certificate-table-area">
                    <tr class="sb-certificate-header">
                      <td colspan="3">
                        <div class="state-symbol">
                          <img src="assets/images/gujarat-state-logo.png" class="sb-certificatePage-logo"
                            alt="Government of Gujarat">
                        </div>
                        <p class="state-name">Government of Gujarat</p>
                        <h1>Best Student Certificate</h1>
                        <p class="certificate-details">This is to certify that Mr/Ms<strong>Student Name</strong>
                          is certified as <strong>"Best Student"</strong> on<strong>25 May 2019</strong> </p>
                      </td>
                    </tr>
                    <tr class="sb-certificate-footer">
                      <td class="country-symbol">
                        <img src="assets/images/DIKSHA.png" class="sb-certificatePage-logo" />
                        <!-- <p>આ દસ્તાવેજ ડિજિટલ સહી થયેલ છે</p> -->
                      </td>
                      <td class="state-sign">
                        <img src="$signatory0Image" class="sb-certificatePage-logo" />
                        <div class="sign-line"></div>
                        <p class="italic">Director of GCERT</p>
                      </td>
                      <td class="certificate-qr-code">
                        <img src="assets/images/sb-qr-code.svg" width="60" class="sb-certificate-qrcode" />
                        <p>Scan to verify certificate</p>
                      </td>
                    </tr>
                  </table>

                </div>
                <div class="sb-certificate-bg-"></div>
              </td>
            </tr>
          </table>
        </div>
      </div>
      <div>
        <button appTelemetryInteract [disabled]="!selectedOption" [telemetryInteractEdata]="telemetryInteract"
          class="sb-btn sb-btn-sm sb-btn-primary btn-block" (click)="issueCertificate()">Generate</button>
      </div>
    </div>
  </div>

  <app-csv-upload [certType]="selectedOption" *ngIf="showModal"></app-csv-upload>

  <div *ngIf="showCertDashboard && (programDetails?.userDetails?.roles.includes('CERTIFICATE_ISSUER'))"
    class="ui mt-30 container w-300 sb-box-container">
    <app-certificate-dashboard></app-certificate-dashboard>
  </div>
</div>

<div *ngIf="!showCertificate">
  <div *ngIf='programDetails?.userDetails' class="ui segment m-0 w-300 no-bg" style="margin-top:2px !important;">

    <div *ngIf="stages[currentStage] === 'chooseClass'">
      <app-select-textbook [sessionContext]="sessionContext" [config]="programDetails.config"
        (selectedClassSubjectEvent)="selectedClassSubjectHandler($event)"></app-select-textbook>
    </div>

    <div class="ui container"
      *ngIf="stages[currentStage] === 'chooseTextbook' || stages[currentStage] === 'topicList' ">
      <div class="sb-pageSection">
        <div class="sb-pageSection-header d-flex flex-jc-space-between pt-16">
          <div>
            <span class="fs-1-143 font-weight-bold m-0 mr-8">Searched results for </span>
            <span
              class="sb-pageSection-count sb-label sb-label-xs sb-label-warning mr-8">{{sessionContext.gradeLevel}}</span>
            <span
              class="sb-pageSection-count sb-label sb-label-xs sb-label-warning mr-8">{{sessionContext.subject}}</span>
            <span *ngIf="stages[currentStage] === 'topicList' || stages[currentStage] === 'createQuestion'"
              class="sb-pageSection-count sb-label sb-label-xs sb-label-warning">{{sessionContext.textbookName}}</span>
          </div>
          <div *ngIf="stages[currentStage] === 'topicList' && role.currentRole === 'REVIEWER'">
            <div *ngFor="let field of formFieldOptions">
              <div *ngIf="field.inputType ==='select' && field.code === 'school'"
                class="field d-flex flex-jc-center flex-ai-center">
                <label class="mr-8 mb-0">Select {{field.label}}</label>
                <div class="sb-field mb-0">
                  <sui-select [isSearchable]="true" id={{field.code}} name={{field.code}} class="selection"
                    [(ngModel)]="selectedSchoolForReview" labelField="name" valueField="name" [options]="field.range"
                    #select>
                    <sui-select-option *ngFor="let option of select.filteredOptions" [value]="option">
                    </sui-select-option>
                  </sui-select>
                </div>
              </div>
            </div>
          </div>
          <button (click)="navigate('prev')" appTelemetryInteract
            [telemetryInteractEdata]="{id:'back_btn',type:'click',pageid:stages[currentStage].toLowerCase()}"
            class="sb-btn sb-btn-normal sb-btn-error">Back <i class="chevron circle left icon"></i></button>
        </div>
      </div>
      <div *ngIf="stages[currentStage] === 'chooseTextbook'">
        <app-textbook-list [sessionContext]="sessionContext" [config]="programDetails.config"
          (selectedTextbookEvent)="selectedTextbookHandler($event)"></app-textbook-list>
      </div>
      <div *ngIf="stages[currentStage] === 'topicList' && !showDashboard">
        <!-- <app-chapter-list [topicList]="topicList" [sessionContext]="sessionContext"
          [selectedSchool]="selectedSchoolForReview" [role]="role"
          (selectedQuestionTypeTopic)="selectedQuestionTypeTopic($event)"></app-chapter-list> -->
      </div>
      <div *ngIf="stages[currentStage] === 'topicList' && showDashboard">
        <app-dashboard [sessionContext]="sessionContext"></app-dashboard>
      </div>
    </div>


    <div class="ui container" *ngIf="stages[currentStage] === 'createQuestion'">
      <div class="sb-pageSection">
        <div class="sb-pageSection-header ui grid">

          <div class="three wide column">
            <div>
              <span class="fs-1-143 font-weight-bold m-0 mr-8">Searched results for</span>
              <span
                class="sb-pageSection-count sb-label sb-label-xs sb-label-warning">{{sessionContext.topic}}</span>
            </div>
          </div>
          <div class="nine wide column p-0">
            <div class="d-flex flex-ai-end">
              <div
                *ngIf="stages[currentStage] === 'createQuestion' && role.currentRole === 'REVIEWER' && selectedSchoolForReview !== undefined"
                class="field d-flex flex-jc-center flex-ai-center">
                <span><b>Selected School:</b> <span style="font-style: italic">{{selectedSchoolForReview}}</span></span>
              </div>
              <div
                *ngIf="stages[currentStage] === 'createQuestion' && role.currentRole != 'REVIEWER' && role.currentRole != 'CONTRIBUTOR'"
                class="field d-flex flex-ai-center flex-basis-1">
                <div class="sb-field-group w-50">
                  <label>Practice Set Name</label>
                  <div class="sb-field m-0">
                    <input autofocus="" [(ngModel)]='resourceName' (keyup)="onResourceNameChange($event)"
                      class="sb-form-control" type="text" placeholder="Name">
                  </div>
                </div>
              </div>
              <div class="d-flex ml-auto">
                <button
                  *ngIf="role.currentRole !== 'REVIEWER' && role.currentRole !== 'CONTRIBUTOR' && sessionContext.resourceIdentifier"
                  class="sb-btn sb-btn-primary sb-btn-normal mr-10" [disabled]="publishInProgress" appTelemetryInteract
                  [telemetryInteractEdata]="{id:'publich_questions',type:'click',pageid:stages[currentStage].toLowerCase()}"
                  (click)="sendResourceName();questionList.updateQuestions() ">Update</button>
                <button
                  *ngIf="role.currentRole !== 'REVIEWER' && role.currentRole !== 'CONTRIBUTOR' && !sessionContext.resourceIdentifier"
                  class="sb-btn sb-btn-primary sb-btn-normal mr-10" [disabled]="publishInProgress" appTelemetryInteract
                  [telemetryInteractEdata]="{id:'publich_questions',type:'click',pageid:stages[currentStage].toLowerCase()}"
                  (click)="sendResourceName(); questionList.publishQuestions()">Publish</button>
                <button *ngIf="!isPreviewShown" (click)="navigate('prev')" appTelemetryInteract
                  [telemetryInteractEdata]="{id:'back_btn',type:'click',pageid:stages[currentStage].toLowerCase()}"
                  class="sb-btn sb-btn-normal sb-btn-error">Back <i class="chevron circle left icon"></i></button>
              </div>
            </div>
          </div>
        </div>
      </div>
      <app-question-list #questionList (statusEmitter)="handleRefresEvent($event)"

        (changeStage)="navigate($event)" (publishButtonStatus)="publishButtonStatusHandler($event)">
      </app-question-list>
    </div>
  </div>
</div>
